{"version":3,"file":"app.js","sources":["../src/lib/config.ts","../src/lib/logger.ts","../src/app.ts"],"sourcesContent":["import { z } from 'zod';\r\n\r\nconst ConfigSchema = z.object({\r\n  nodeEnv: z.enum(['development', 'production', 'test']).default('development'),\r\n  port: z.coerce.number().int().min(1).max(65535).default(3001),\r\n  logLevel: z.enum(['error', 'warn', 'info', 'debug']).default('info'),\r\n  outputPath: z.string().default('./output'),\r\n  devLogRequests: z.coerce.boolean().default(true),\r\n  devEnableCors: z.coerce.boolean().default(true)\r\n});\r\n\r\nexport type Config = z.infer<typeof ConfigSchema>;\r\n\r\nfunction loadConfig(): Config {\r\n  const rawConfig = {\r\n    nodeEnv: process.env.NODE_ENV,\r\n    port: process.env.PORT,\r\n    logLevel: process.env.LOG_LEVEL,\r\n    outputPath: process.env.OUTPUT_PATH,\r\n    devLogRequests: process.env.DEV_LOG_REQUESTS,\r\n    devEnableCors: process.env.DEV_ENABLE_CORS\r\n  };\r\n\r\n  try {\r\n    return ConfigSchema.parse(rawConfig);\r\n  } catch (error) {\r\n    console.error('Configuration validation failed:', error);\r\n    process.exit(1);\r\n  }\r\n}\r\n\r\nexport const config = loadConfig();\r\n","import { config } from './config';\r\n\r\nexport enum LogLevel {\r\n  ERROR = 0,\r\n  WARN = 1,\r\n  INFO = 2,\r\n  DEBUG = 3\r\n}\r\n\r\nconst LogLevelMap: Record<string, LogLevel> = {\r\n  error: LogLevel.ERROR,\r\n  warn: LogLevel.WARN,\r\n  info: LogLevel.INFO,\r\n  debug: LogLevel.DEBUG\r\n};\r\n\r\nclass Logger {\r\n  private readonly level: LogLevel;\r\n\r\n  constructor() {\r\n    this.level = LogLevelMap[config.logLevel] ?? LogLevel.INFO;\r\n  }\r\n\r\n  private log(level: LogLevel, message: string, ...args: unknown[]): void {\r\n    if (level <= this.level) {\r\n      const timestamp = new Date().toISOString();\r\n      const levelName = LogLevel[level];\r\n      const prefix = `[${timestamp}] [${levelName}]`;\r\n      \r\n      switch (level) {\r\n        case LogLevel.ERROR:\r\n          console.error(prefix, message, ...args);\r\n          break;\r\n        case LogLevel.WARN:\r\n          console.warn(prefix, message, ...args);\r\n          break;\r\n        case LogLevel.INFO:\r\n          console.info(prefix, message, ...args);\r\n          break;\r\n        case LogLevel.DEBUG:\r\n          console.debug(prefix, message, ...args);\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  error(message: string, ...args: unknown[]): void {\r\n    this.log(LogLevel.ERROR, message, ...args);\r\n  }\r\n\r\n  warn(message: string, ...args: unknown[]): void {\r\n    this.log(LogLevel.WARN, message, ...args);\r\n  }\r\n\r\n  info(message: string, ...args: unknown[]): void {\r\n    this.log(LogLevel.INFO, message, ...args);\r\n  }\r\n\r\n  debug(message: string, ...args: unknown[]): void {\r\n    this.log(LogLevel.DEBUG, message, ...args);\r\n  }\r\n}\r\n\r\nexport const logger = new Logger();\r\n","import express from 'express';\r\nimport { config } from './lib/config';\r\nimport { logger } from './lib/logger';\r\n\r\nconst app = express();\r\n\r\n// Basic middleware\r\napp.use(express.json({ limit: '10mb' }));\r\napp.use(express.urlencoded({ extended: true }));\r\n\r\n// CORS middleware for development\r\nif (config.devEnableCors && config.nodeEnv === 'development') {\r\n  app.use((req, res, next) => {\r\n    res.header('Access-Control-Allow-Origin', '*');\r\n    res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\r\n    res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization');\r\n    \r\n    if (req.method === 'OPTIONS') {\r\n      res.sendStatus(200);\r\n    } else {\r\n      next();\r\n    }\r\n  });\r\n}\r\n\r\n// Request logging middleware for development\r\nif (config.devLogRequests && config.nodeEnv === 'development') {\r\n  app.use((req, res, next) => {\r\n    logger.info(`${req.method} ${req.path}`, {\r\n      body: req.body,\r\n      query: req.query,\r\n      params: req.params\r\n    });\r\n    next();\r\n  });\r\n}\r\n\r\n// Health check endpoint\r\napp.get('/health', (req, res) => {\r\n  res.json({\r\n    status: 'healthy',\r\n    timestamp: new Date().toISOString(),\r\n    environment: config.nodeEnv,\r\n    version: '1.0.0'\r\n  });\r\n});\r\n\r\n// Basic API routes placeholder\r\napp.use('/api', (req, res) => {\r\n  res.status(404).json({\r\n    success: false,\r\n    error: 'API endpoint not implemented yet'\r\n  });\r\n});\r\n\r\n// Global error handler\r\napp.use((err: Error, req: express.Request, res: express.Response, _next: express.NextFunction) => {\r\n  logger.error('Unhandled error:', err);\r\n  \r\n  res.status(500).json({\r\n    success: false,\r\n    error: config.nodeEnv === 'development' ? err.message : 'Internal server error'\r\n  });\r\n});\r\n\r\n// 404 handler\r\napp.use((req, res) => {\r\n  res.status(404).json({\r\n    success: false,\r\n    error: 'Route not found'\r\n  });\r\n});\r\n\r\n// Start server\r\nconst server = app.listen(config.port, () => {\r\n  logger.info(`DDCMS Direct File Creator started on port ${config.port}`);\r\n  logger.info(`Environment: ${config.nodeEnv}`);\r\n  logger.info(`Output directory: ${config.outputPath}`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on('SIGTERM', () => {\r\n  logger.info('SIGTERM received, shutting down gracefully');\r\n  server.close(() => {\r\n    logger.info('Server closed');\r\n    process.exit(0);\r\n  });\r\n});\r\n\r\nprocess.on('SIGINT', () => {\r\n  logger.info('SIGINT received, shutting down gracefully');\r\n  server.close(() => {\r\n    logger.info('Server closed');\r\n    process.exit(0);\r\n  });\r\n});\r\n\r\nexport default app;\r\n"],"names":["LogLevel"],"mappings":"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"}